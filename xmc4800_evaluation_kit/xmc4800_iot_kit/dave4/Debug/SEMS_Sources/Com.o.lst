   1              	 .syntax unified
   2              	 .cpu cortex-m4
   3              	 .eabi_attribute 27,3
   4              	 .fpu fpv4-sp-d16
   5              	 .eabi_attribute 20,1
   6              	 .eabi_attribute 21,1
   7              	 .eabi_attribute 23,3
   8              	 .eabi_attribute 24,1
   9              	 .eabi_attribute 25,1
  10              	 .eabi_attribute 26,1
  11              	 .eabi_attribute 30,2
  12              	 .eabi_attribute 34,1
  13              	 .eabi_attribute 18,4
  14              	 .thumb
  15              	 .file "Com.c"
  16              	 .text
  17              	.Ltext0:
  18              	 .cfi_sections .debug_frame
  19              	 .section .text.secure_communication,"ax",%progbits
  20              	 .align 2
  21              	 .global secure_communication
  22              	 .thumb
  23              	 .thumb_func
  25              	secure_communication:
  26              	.LFB454:
  27              	 .file 1 "../SEMS_Sources/Com.c"
   1:../SEMS_Sources/Com.c **** #include "optiga/optiga_crypt.h"
   2:../SEMS_Sources/Com.c **** #include "optiga/optiga_util.h"
   3:../SEMS_Sources/Com.c **** #include "optiga/common/optiga_lib_logger.h"
   4:../SEMS_Sources/Com.c **** #include "optiga/pal/pal_os_event.h"
   5:../SEMS_Sources/Com.c **** #include "optiga/pal/pal.h"
   6:../SEMS_Sources/Com.c **** #include "optiga/pal/pal_os_timer.h"
   7:../SEMS_Sources/Com.c **** #include "optiga_example.h"
   8:../SEMS_Sources/Com.c **** #include "optiga/pal/pal_logger.h"
   9:../SEMS_Sources/Com.c **** 
  10:../SEMS_Sources/Com.c **** #include "../SEMS_Headers/Com.h"
  11:../SEMS_Sources/Com.c **** #include "../SEMS_Headers/SymEncrypt.h"
  12:../SEMS_Sources/Com.c **** #include "../SEMS_Headers/RSA.h"
  13:../SEMS_Sources/Com.c **** #include "../SEMS_Headers/Random.h"
  14:../SEMS_Sources/Com.c **** #include "../SEMS_Headers/Patcher.h"
  15:../SEMS_Sources/Com.c **** 
  16:../SEMS_Sources/Com.c **** extern pal_logger_t logger_console;
  17:../SEMS_Sources/Com.c **** 
  18:../SEMS_Sources/Com.c **** extern void example_optiga_util_update_count(void);
  19:../SEMS_Sources/Com.c **** 
  20:../SEMS_Sources/Com.c **** uint8_t secure_communication(void)
  21:../SEMS_Sources/Com.c **** {
  28              	 .loc 1 21 0
  29              	 .cfi_startproc
  30              	 
  31              	 
  32 0000 2DE9F041 	 push {r4,r5,r6,r7,r8,lr}
  33              	.LCFI0:
  34              	 .cfi_def_cfa_offset 24
  35              	 .cfi_offset 4,-24
  36              	 .cfi_offset 5,-20
  37              	 .cfi_offset 6,-16
  38              	 .cfi_offset 7,-12
  39              	 .cfi_offset 8,-8
  40              	 .cfi_offset 14,-4
  22:../SEMS_Sources/Com.c ****     uint8_t random_buf[32] = {0x01, 0x01, 0x01, 0x01};
  41              	 .loc 1 22 0
  42 0004 0024     	 movs r4,#0
  21:../SEMS_Sources/Com.c ****     uint8_t random_buf[32] = {0x01, 0x01, 0x01, 0x01};
  43              	 .loc 1 21 0
  44 0006 B4B0     	 sub sp,sp,#208
  45              	.LCFI1:
  46              	 .cfi_def_cfa_offset 232
  23:../SEMS_Sources/Com.c ****     uint8_t ciphertext[129] = {0x00};
  47              	 .loc 1 23 0
  48 0008 4FF08108 	 mov r8,#129
  22:../SEMS_Sources/Com.c ****     uint8_t random_buf[32] = {0x01, 0x01, 0x01, 0x01};
  49              	 .loc 1 22 0
  50 000c 0127     	 movs r7,#1
  51              	 .loc 1 23 0
  52 000e 4246     	 mov r2,r8
  53 0010 2146     	 mov r1,r4
  54 0012 13A8     	 add r0,sp,#76
  22:../SEMS_Sources/Com.c ****     uint8_t random_buf[32] = {0x01, 0x01, 0x01, 0x01};
  55              	 .loc 1 22 0
  56 0014 0394     	 str r4,[sp,#12]
  57 0016 0494     	 str r4,[sp,#16]
  58 0018 0594     	 str r4,[sp,#20]
  59 001a 0694     	 str r4,[sp,#24]
  60 001c 0794     	 str r4,[sp,#28]
  61 001e 0894     	 str r4,[sp,#32]
  62 0020 0994     	 str r4,[sp,#36]
  63 0022 8DF80870 	 strb r7,[sp,#8]
  64 0026 8DF80970 	 strb r7,[sp,#9]
  65 002a 8DF80A70 	 strb r7,[sp,#10]
  66 002e 8DF80B70 	 strb r7,[sp,#11]
  67              	 .loc 1 23 0
  68 0032 FFF7FEFF 	 bl memset
  69              	.LVL0:
  24:../SEMS_Sources/Com.c ****     uint16_t ciphertext_len = 128;
  25:../SEMS_Sources/Com.c ****     uint8_t nonce[4] = {0x01, 0x01, 0x01, 0x01};
  70              	 .loc 1 25 0
  71 0036 194B     	 ldr r3,.L3
  72 0038 1868     	 ldr r0,[r3]
  73 003a 0190     	 str r0,[sp,#4]
  24:../SEMS_Sources/Com.c ****     uint16_t ciphertext_len = 128;
  74              	 .loc 1 24 0
  75 003c 8023     	 movs r3,#128
  26:../SEMS_Sources/Com.c **** 
  27:../SEMS_Sources/Com.c **** 
  28:../SEMS_Sources/Com.c **** 	// Generate random number using Optiga for session key
  29:../SEMS_Sources/Com.c **** 	optiga_crypt_random_wrapper(random_buf, 32);
  76              	 .loc 1 29 0
  77 003e 02A8     	 add r0,sp,#8
  78 0040 2021     	 movs r1,#32
  24:../SEMS_Sources/Com.c ****     uint16_t ciphertext_len = 128;
  79              	 .loc 1 24 0
  80 0042 ADF80230 	 strh r3,[sp,#2]
  30:../SEMS_Sources/Com.c **** 
  31:../SEMS_Sources/Com.c **** 	// Get Nonce
  32:../SEMS_Sources/Com.c **** 	uint16_t optiga_counter_oid = 0xE120;
  33:../SEMS_Sources/Com.c **** //	optiga_util_reset_count(optiga_counter_oid);
  34:../SEMS_Sources/Com.c **** 	optiga_util_read_nonce(optiga_counter_oid, nonce, sizeof(nonce));
  35:../SEMS_Sources/Com.c **** 
  36:../SEMS_Sources/Com.c **** 
  37:../SEMS_Sources/Com.c **** 	// Encrypt the session key with RSA
  38:../SEMS_Sources/Com.c **** 	uint8_t plaintext[32 + 4] = {0};
  39:../SEMS_Sources/Com.c **** 	memcpy(plaintext, random_buf, 32);
  81              	 .loc 1 39 0
  82 0046 02AE     	 add r6,sp,#8
  29:../SEMS_Sources/Com.c **** 
  83              	 .loc 1 29 0
  84 0048 FFF7FEFF 	 bl optiga_crypt_random_wrapper
  85              	.LVL1:
  34:../SEMS_Sources/Com.c **** 
  86              	 .loc 1 34 0
  87 004c 01A9     	 add r1,sp,#4
  88 004e 4EF22010 	 movw r0,#57632
  89 0052 0422     	 movs r2,#4
  90 0054 FFF7FEFF 	 bl optiga_util_read_nonce
  91              	.LVL2:
  92              	 .loc 1 39 0
  93 0058 0FCE     	 ldmia r6!,{r0,r1,r2,r3}
  94 005a 0AAD     	 add r5,sp,#40
  38:../SEMS_Sources/Com.c **** 	memcpy(plaintext, random_buf, 32);
  95              	 .loc 1 38 0
  96 005c 0F94     	 str r4,[sp,#60]
  97 005e 1094     	 str r4,[sp,#64]
  98 0060 1194     	 str r4,[sp,#68]
  99              	 .loc 1 39 0
 100 0062 0FC5     	 stmia r5!,{r0,r1,r2,r3}
 101 0064 96E80F00 	 ldmia r6,{r0,r1,r2,r3}
  40:../SEMS_Sources/Com.c **** 	memcpy(plaintext + 32, nonce, 4);
 102              	 .loc 1 40 0
 103 0068 019C     	 ldr r4,[sp,#4]
  39:../SEMS_Sources/Com.c **** 	memcpy(plaintext + 32, nonce, 4);
 104              	 .loc 1 39 0
 105 006a 85E80F00 	 stmia r5,{r0,r1,r2,r3}
  41:../SEMS_Sources/Com.c **** 	optiga_crypt_rsa_encrypt_message_wrapper(plaintext, sizeof(plaintext), ciphertext, &ciphertext_len
 106              	 .loc 1 41 0
 107 006e 13AA     	 add r2,sp,#76
 108 0070 0DF10203 	 add r3,sp,#2
 109 0074 0AA8     	 add r0,sp,#40
 110 0076 2421     	 movs r1,#36
  40:../SEMS_Sources/Com.c **** 	memcpy(plaintext + 32, nonce, 4);
 111              	 .loc 1 40 0
 112 0078 1294     	 str r4,[sp,#72]
 113              	 .loc 1 41 0
 114 007a FFF7FEFF 	 bl optiga_crypt_rsa_encrypt_message_wrapper
 115              	.LVL3:
  42:../SEMS_Sources/Com.c **** 
  43:../SEMS_Sources/Com.c **** 	// Send session key to the App
  44:../SEMS_Sources/Com.c **** 	if(ciphertext_len == 128)
  45:../SEMS_Sources/Com.c **** 	{
  46:../SEMS_Sources/Com.c **** 		// Pana la 127 merge ok
  47:../SEMS_Sources/Com.c **** 		optiga_lib_print_bytes(ciphertext, 129); // TODO: TREBUIE SA TRIMIT CU UNUL IN PLUS ALTFEL RAMAN 
 116              	 .loc 1 47 0
 117 007e 13A8     	 add r0,sp,#76
 118 0080 4146     	 mov r1,r8
 119 0082 FFF7FEFF 	 bl optiga_lib_print_bytes
 120              	.LVL4:
  48:../SEMS_Sources/Com.c **** 	}
  49:../SEMS_Sources/Com.c **** 	else
  50:../SEMS_Sources/Com.c **** 	{
  51:../SEMS_Sources/Com.c **** 		// Sens 128 0s, encrypt nu a functionat
  52:../SEMS_Sources/Com.c **** 		optiga_lib_print_bytes(ciphertext, 129);
  53:../SEMS_Sources/Com.c **** 	}
  54:../SEMS_Sources/Com.c **** 
  55:../SEMS_Sources/Com.c **** 	// Store session key
  56:../SEMS_Sources/Com.c **** 	uint16_t optiga_key_oid = 0xF1E0;
  57:../SEMS_Sources/Com.c **** 	optiga_util_write_shared_key(optiga_key_oid, random_buf, sizeof(random_buf));
 121              	 .loc 1 57 0
 122 0086 02A9     	 add r1,sp,#8
 123 0088 4FF2E010 	 movw r0,#61920
 124 008c 2022     	 movs r2,#32
 125 008e FFF7FEFF 	 bl optiga_util_write_shared_key
 126              	.LVL5:
  58:../SEMS_Sources/Com.c **** 
  59:../SEMS_Sources/Com.c **** 
  60:../SEMS_Sources/Com.c **** 	// Reaqd session key, Testing
  61:../SEMS_Sources/Com.c **** //	uint8_t key[32] = {0x01, 0x01, 0x01, 0x01};
  62:../SEMS_Sources/Com.c **** //	optiga_util_read_shared_key(optiga_key_oid, key, sizeof(key));
  63:../SEMS_Sources/Com.c **** //	ciphertext_len = ciphertext_len; // BR
  64:../SEMS_Sources/Com.c **** 	return true;
  65:../SEMS_Sources/Com.c **** }
 127              	 .loc 1 65 0
 128 0092 3846     	 mov r0,r7
 129 0094 34B0     	 add sp,sp,#208
 130              	.LCFI2:
 131              	 .cfi_def_cfa_offset 24
 132              	 
 133 0096 BDE8F081 	 pop {r4,r5,r6,r7,r8,pc}
 134              	.L4:
 135 009a 00BF     	 .align 2
 136              	.L3:
 137 009c 00000000 	 .word .LANCHOR0
 138              	 .cfi_endproc
 139              	.LFE454:
 141              	 .section .rodata
 142              	 .align 2
 143              	 .set .LANCHOR0,.+0
 144              	.LC0:
 145 0000 01       	 .byte 1
 146 0001 01       	 .byte 1
 147 0002 01       	 .byte 1
 148 0003 01       	 .byte 1
 149              	 .text
 150              	.Letext0:
 151              	 .file 2 "c:\\infineon\\tools\\dave ide\\4.5.0.202105191637\\eclipse\\arm-gcc-49\\arm-none-eabi\\include\\machine\\_default_types.h"
 152              	 .file 3 "c:\\infineon\\tools\\dave ide\\4.5.0.202105191637\\eclipse\\arm-gcc-49\\arm-none-eabi\\include\\stdint.h"
 153              	 .file 4 "D:/School/diseratie/SEMS/xmc4800_evaluation_kit/xmc4800_iot_kit/common/Libraries/CMSIS/Infineon/XMC4800_series/Include/XMC4800.h"
 154              	 .file 5 "D:/School/diseratie/SEMS/xmc4800_evaluation_kit/xmc4800_iot_kit/common/Libraries/XMCLib/inc/xmc_usbd_regs.h"
 155              	 .file 6 "D:/School/diseratie/SEMS/xmc4800_evaluation_kit/xmc4800_iot_kit/common/Libraries/XMCLib/inc/xmc_usbd.h"
 156              	 .file 7 "D:/School/diseratie/SEMS/xmc4800_evaluation_kit/xmc4800_iot_kit/common/Dave/Generated/USBD/usbd.h"
 157              	 .file 8 "D:/School/diseratie/SEMS/xmc4800_evaluation_kit/xmc4800_iot_kit/common/Libraries/CMSIS/Include/core_cm4.h"
 158              	 .file 9 "D:/School/diseratie/SEMS/xmc4800_evaluation_kit/xmc4800_iot_kit/common/Libraries/CMSIS/Infineon/XMC4800_series/Include/system_XMC4800.h"
 159              	 .file 10 "D:/School/diseratie/SEMS/xmc4800_evaluation_kit/xmc4800_iot_kit/common/Dave/Generated/USBD/usbd_extern.h"
 160              	 .file 11 "../SEMS_Sources/../SEMS_Headers/Random.h"
 161              	 .file 12 "../SEMS_Sources/../SEMS_Headers/Patcher.h"
 162              	 .file 13 "../SEMS_Sources/../SEMS_Headers/RSA.h"
 163              	 .file 14 "D:/School/diseratie/SEMS/xmc4800_evaluation_kit/optiga-trust-m/optiga/include/optiga/common/optiga_lib_logger.h"
 164              	 .file 15 "../SEMS_Sources/../SEMS_Headers/SymEncrypt.h"
DEFINED SYMBOLS
                            *ABS*:00000000 Com.c
    {standard input}:20     .text.secure_communication:00000000 $t
    {standard input}:25     .text.secure_communication:00000000 secure_communication
    {standard input}:137    .text.secure_communication:0000009c $d
    {standard input}:142    .rodata:00000000 $d
                     .debug_frame:00000010 $d

UNDEFINED SYMBOLS
memset
optiga_crypt_random_wrapper
optiga_util_read_nonce
optiga_crypt_rsa_encrypt_message_wrapper
optiga_lib_print_bytes
optiga_util_write_shared_key
